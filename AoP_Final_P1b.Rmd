---
title: "AoP_Analyses_Final"
author: "Brianna Shaughnessy"
date: "11/2/2021"
output:
  html_document: default
  pdf_document: default
  word_document: default
---
This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

##R packages required for these analyses
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)
library(ggplot2)
library(emmeans)
library(dplyr)
library(multcompView)
library(kableExtra)
library(DHARMa)
library(betareg)
library(aod)
library(MASS)
library(brant)
library(patchwork)
library(rstatix)
library(RVAideMemoire)
library(ordinal)
library(xtable)
library(cowplot)

```

##NOTE: for the purposes of this code, "Survey 2" = marine aquaculture survey (MA survey) and "Survey 3" = seaweed farming survey (SW survey). The code is annotated throughout to explain transformations and groupings. Overall, in the chunk of code that follows, initial transformations resulted the following important groupings that are then used throughout the analysis:

Opinion: 1 = never heard of it, 2 = heard of it but know little about it, 3 = somewhat familiar, 4 = very familiar.

Familiarity: 1 = unfavorable, 2 = neutral, 3 = favorable, 4 = not sure

Region: survey_2 regions (MA survey) were filtered down to only responses from the states that were also surveyed in survey_3 (SW survey).

Education: Due to skewed samples, the 7-8 categories were collapsed into 1 = high school or less, 2 = undergraduate or vocational training, 3 = graduate work or degree.

```{r, Full datasets with initial transformations, include = FALSE}

survey_2 <- read_csv("/Users/briannashaughnessy/Desktop/Aqua_Messaging_Analyses/final_survey_2.csv")

survey_3 <- read_csv("/Users/briannashaughnessy/Desktop/Aqua_Messaging_Analyses/final_survey_3.csv")

#adjust survey 2 regions to match survey 3 regions with a new categorical column labeled Region_s3. NOTE: Alaska collapsed into PNW category due to low sample size
survey_2$Region_s3 = as.numeric(survey_2$survey_2_region)
survey_2$Region_s3 <- case_when(
  survey_2$Region_s3 %% 8 == 0 ~ "South",
  survey_2$Region_s3 %% 7 == 0 ~ "West",
  survey_2$Region_s3 %% 6 == 0 ~ "Midwest",
  survey_2$Region_s3 %% 5 == 0 ~ "Mid Atlantic",
  survey_2$Region_s3 %% 4 == 0 ~ "New England",
  survey_2$Region_s3 %% 3 == 0 ~ "California",
  survey_2$Region_s3 %% 2 == 0 ~ "Pacific Northwest",
  survey_2$Region_s3 %% 1 == 0 ~ "Pacific Northwest")

#Remove the regions from survey 2 that were not sampled in survey 3
survey_2 <- survey_2 %>%
 dplyr::filter(Region_s3 != "South")
survey_2 <- survey_2 %>%
  dplyr::filter(Region_s3 != "Mid Atlantic")
survey_2 <- survey_2 %>%
  dplyr::filter(Region_s3 != "Midwest")
table(survey_2$Region_s3)
survey_2 <- survey_2 %>%
  dplyr::filter(Region_s3 != "West")# Final n = 154

#re-order likert scales to be more intuitive for rest of analyses.  
# 1 = unfavorable, 2 = neutral, 3 = favorable, 4 = not sure
survey_2$Opinion_aqua_pre = as.numeric(survey_2$Opinion_aqua_pre)
table(survey_2$Opinion_aqua_pre)
survey_2$Opinion_aqua_pre <- case_when(
  survey_2$Opinion_aqua_pre %% 6 == 0 ~ 4,
  survey_2$Opinion_aqua_pre %% 5 == 0 ~ 1,
  survey_2$Opinion_aqua_pre %% 4 == 0 ~ 1,
  survey_2$Opinion_aqua_pre %% 3 == 0 ~ 2,
  survey_2$Opinion_aqua_pre %% 2 == 0 ~ 3,
  survey_2$Opinion_aqua_pre %% 1 == 0 ~ 3) 

survey_2$Opinion_aqua_post = as.numeric(survey_2$Opinion_aqua_post)
table(survey_2$Opinion_aqua_post)
survey_2$Opinion_aqua_post <- case_when(
  survey_2$Opinion_aqua_post %% 6 == 0 ~ 4,
  survey_2$Opinion_aqua_post %% 5 == 0 ~ 1,
  survey_2$Opinion_aqua_post %% 4 == 0 ~ 1,
  survey_2$Opinion_aqua_post %% 3 == 0 ~ 2,
  survey_2$Opinion_aqua_post %% 2 == 0 ~ 3,
  survey_2$Opinion_aqua_post %% 1 == 0 ~ 3)

#Same transformation for support for expansion where 1 = very unlikely, 5 = very likely to support.
survey_2$Support_pre = as.numeric(survey_2$Support_pre)
table(survey_2$Support_pre)
survey_2$Support_pre <- case_when(
  survey_2$Support_pre %% 5 == 0 ~ 1,
  survey_2$Support_pre %% 4 == 0 ~ 2,
  survey_2$Support_pre %% 3 == 0 ~ 3,
  survey_2$Support_pre %% 2 == 0 ~ 4,
  survey_2$Support_pre %% 1 == 0 ~ 5) #1 = very unlikley, 5 = very likely

survey_2$Support_post = as.numeric(survey_2$Support_post)
table(survey_2$Support_post)
survey_2$Support_post <- case_when(
  survey_2$Support_post %% 5 == 0 ~ 1,
  survey_2$Support_post %% 4 == 0 ~ 2,
  survey_2$Support_post %% 3 == 0 ~ 3,
  survey_2$Support_post %% 2 == 0 ~ 4,
  survey_2$Support_post %% 1 == 0 ~ 5)

#Transform education categories into three categories to avoid violating the assumptions of low expected values across groups with low representation.
survey_2$Education = as.numeric(survey_2$Education)
table(survey_2$Education)
survey_2$Education_collapsed <- case_when(
  survey_2$Education %% 9 == 0 ~ 3,
  survey_2$Education %% 8 == 0 ~ 3,
  survey_2$Education %% 7 == 0 ~ 3,
  survey_2$Education %% 6 == 0 ~ 2,
  survey_2$Education %% 5 == 0 ~ 2,
  survey_2$Education %% 4 == 0 ~ 2,
  survey_2$Education %% 3 == 0 ~ 1,
  survey_2$Education %% 2 == 0 ~ 1,
  survey_2$Education %% 1 == 0 ~ 1)
table(survey_2$Education_collapsed)

#Survey 3 same transformations
#End categories are: 1 = unfavorable, 2 = neutral, 3 = favorable, 4 = don't know, 7 = never heard.
survey_3$Opinion_seaweed = as.numeric(survey_3$Opinion_seaweed)
table(survey_3$Opinion_seaweed)
survey_3$Opinion_seaweed <- case_when(
  survey_3$Opinion_seaweed %% 7 == 0 ~ 7,
  survey_3$Opinion_seaweed %% 6 == 0 ~ 4,
  survey_3$Opinion_seaweed %% 5 == 0 ~ 1,
  survey_3$Opinion_seaweed %% 4 == 0 ~ 1,
  survey_3$Opinion_seaweed %% 3 == 0 ~ 2,
  survey_3$Opinion_seaweed %% 2 == 0 ~ 3,
  survey_3$Opinion_seaweed %% 1 == 0 ~ 3)

survey_3$Opinion_seaweed_post = as.numeric(survey_3$Opinion_seaweed_post)
table(survey_3$Opinion_seaweed_post)
survey_3$Opinion_seaweed_post <- case_when(
  survey_3$Opinion_seaweed_post %% 6 == 0 ~ 4,
  survey_3$Opinion_seaweed_post %% 5 == 0 ~ 1,
  survey_3$Opinion_seaweed_post %% 4 == 0 ~ 1,
  survey_3$Opinion_seaweed_post %% 3 == 0 ~ 2,
  survey_3$Opinion_seaweed_post %% 2 == 0 ~ 3,
  survey_3$Opinion_seaweed_post %% 1 == 0 ~ 3)

survey_3$Opinion_aquaculture = as.numeric(survey_3$Opinion_aquaculture)
table(survey_3$Opinion_aquaculture)
survey_3$Opinion_aquaculture <- case_when(
  survey_3$Opinion_aquaculture %% 7 == 0 ~ 7,
  survey_3$Opinion_aquaculture %% 6 == 0 ~ 4,
  survey_3$Opinion_aquaculture %% 5 == 0 ~ 1,
  survey_3$Opinion_aquaculture %% 4 == 0 ~ 1,
  survey_3$Opinion_aquaculture %% 3 == 0 ~ 2,
  survey_3$Opinion_aquaculture %% 2 == 0 ~ 3,
  survey_3$Opinion_aquaculture %% 1 == 0 ~ 3)

#NOTE: support expansion scale is different than survey_2. 1 = not sure, 2 = very unlikely to support, 5 = very likely to support
survey_3$Support_seaweed_expansion = as.numeric(survey_3$Support_seaweed_expansion)
survey_3$Support_seaweed_expansion <- case_when(
  survey_3$Support_seaweed_expansion %% 5 == 0 ~ 1,
  survey_3$Support_seaweed_expansion %% 4 == 0 ~ 2,
  survey_3$Support_seaweed_expansion %% 3 == 0 ~ 3,
  survey_3$Support_seaweed_expansion %% 2 == 0 ~ 4,
  survey_3$Support_seaweed_expansion %% 1 == 0 ~ 5)
table(survey_3$Support_seaweed_expansion)

#transform familiarity into a categorical variable in new column
survey_3$Familiarity_aquaculture = as.numeric(survey_3$Familiarity_aquaculture)
table(survey_3$Familiarity_aquaculture)
survey_3$Familiarity_aq_factor <- case_when(
  survey_3$Familiarity_aquaculture %% 4 == 0 ~ "Never heard of it",
  survey_3$Familiarity_aquaculture %% 3 == 0 ~ "Heard of it but know little about it",
  survey_3$Familiarity_aquaculture %% 2 == 0 ~ "Somewhat familiar",
  survey_3$Familiarity_aquaculture %% 1 == 0 ~ "Very familiar")

survey_3$Familiarity_seaweed = as.numeric(survey_3$Familiarity_seaweed)
table(survey_3$Familiarity_seaweed)
survey_3$Familiarity_sw_factor <- case_when(
  survey_3$Familiarity_seaweed %% 4 == 0 ~ "Never heard of it",
  survey_3$Familiarity_seaweed %% 3 == 0 ~ "Heard of it but know little about it",
  survey_3$Familiarity_seaweed %% 2 == 0 ~ "Somewhat familiar",
  survey_3$Familiarity_seaweed %% 1 == 0 ~ "Very familiar")
table(survey_3$Familiarity_sw_factor)

#Also reorder familiarity as numeric categories to be 1 = never heard of it 4 = very familiar
survey_3$Familiarity_aquaculture = as.numeric(survey_3$Familiarity_aquaculture)
table(survey_3$Familiarity_aquaculture)
survey_3$Familiarity_aquaculture <- case_when(
  survey_3$Familiarity_aquaculture %% 4 == 0 ~ 1,
  survey_3$Familiarity_aquaculture %% 3 == 0 ~ 2,
  survey_3$Familiarity_aquaculture %% 2 == 0 ~ 3,
  survey_3$Familiarity_aquaculture %% 1 == 0 ~ 4)

survey_3$Familiarity_seaweed = as.numeric(survey_3$Familiarity_seaweed)
table(survey_3$Familiarity_seaweed)
survey_3$Familiarity_seaweed <- case_when(
  survey_3$Familiarity_seaweed %% 4 == 0 ~ 1,
  survey_3$Familiarity_seaweed %% 3 == 0 ~ 2,
  survey_3$Familiarity_seaweed %% 2 == 0 ~ 3,
  survey_3$Familiarity_seaweed %% 1 == 0 ~ 4)
table(survey_3$Familiarity_sw_factor)

#Transform education categories into three categories to avoid violating the assumptions of low expected values across groups with low representation.
survey_3$Education = as.numeric(survey_3$Education)
table(survey_3$Education)
survey_3$Education_collapsed <- case_when(
  survey_3$Education %% 8 == 0 ~ 3,
  survey_3$Education %% 7 == 0 ~ 3,
  survey_3$Education %% 6 == 0 ~ 3,
  survey_3$Education %% 5 == 0 ~ 2,
  survey_3$Education %% 4 == 0 ~ 2,
  survey_3$Education %% 3 == 0 ~ 2,
  survey_3$Education %% 2 == 0 ~ 1,
  survey_3$Education %% 1 == 0 ~ 1, 
  survey_3$Education %% 0 == 0 ~ 1)
table(survey_3$Education_collapsed)
```

```{r, Initial inspections of the data, include = FALSE}

table(survey_2$Opinion_aqua_post)
s2_edu <- as.data.frame(table(survey_2$Opinion_aqua_pre, survey_2$Education_factor))
s3_edu <- as.data.frame(table(survey_3$Opinion_seaweed, survey_3$Education_factor))
table(survey_3$Education_factor)
table(survey_2$Education_factor)

#Tables for survey 2 opinion frequencies
very_unfav <- survey_2 %>%
  dplyr::filter(Opinion_aqua_pre == "1")
table(very_unfav$Opinion_aqua_post)

unfav <- survey_2 %>%
  dplyr::filter(Opinion_aqua_pre == "2")
table(unfav$Opinion_aqua_post)

neutral <- survey_2 %>%
  dplyr::filter(Opinion_aqua_pre == "3")
table(neutral$Opinion_aqua_post)

not_sure <- survey_2 %>%
  dplyr::filter(Opinion_aqua_pre == "6")
table(not_sure$Opinion_aqua_post)

very_fav <- survey_2 %>%
  dplyr::filter(Opinion_aqua_pre == "5")
table(very_fav$Opinion_aqua_post)

fav <- survey_2 %>%
  dplyr::filter(Opinion_aqua_pre == "4")
table(fav$Opinion_aqua_post)

```

##Baseline opinions by familiarity level (SW survey only)
```{r, ChiSq tests on baseline opinion by familiarity, include = FALSE}

table(survey_3$Familiarity_seaweed)
#remove the 'never heard of it' group (level 1)
seaweed_chisq <- survey_3 %>%
  dplyr::filter(Familiarity_seaweed != 1)
table(seaweed_chisq$Familiarity_seaweed)
table(seaweed_chisq$Opinion_seaweed)
#two respondants selected 7 (never heard of it) in their opinion response. Remove those as outliers.
seaweed_chisq <- seaweed_chisq %>%
  dplyr::filter(Opinion_seaweed != 7)

#test contingency table
sw_chisq_data <- table(seaweed_chisq$Familiarity_sw_factor, seaweed_chisq$Opinion_seaweed) # 1 = unfavorable, 2 = neutral, 3 = favorable, 4 = not sure
chisq_sw <- chisq.test(sw_chisq_data)
expected_sw <- round(chisq_sw$expected, 1)

#ChiSquare to match reporting in the paper where not sure and neutral are collapsed into one column.
know_little_sw <- c(24, 204, 99)
very_somewhat_sw <- c(24, 56, 240)
table_sw_2 <- as.matrix(rbind(know_little_sw, very_somewhat_sw))
chisq_2 <- chisq.test(table_sw_2)
chisq_2_exp <- round(chisq_2$expected, 1)

#same process for opinion of marine aquaculture and familiarity
aquaculture_chisq_data <- survey_3 %>%
  dplyr::filter(Familiarity_aq_factor != 'Never heard of it')
table(aquaculture_chisq_data$Opinion_aquaculture)

#one respondent selected 7 (never heard of it) in their opinion response. Remove as an outlier.
aquaculture_chisq_data <- aquaculture_chisq_data %>%
  dplyr::filter(Opinion_aquaculture != 7)

#ChiSq on full dataset
aq_chisq_table_2 <- table(aquaculture_chisq_data$Familiarity_aq_factor, aquaculture_chisq_data$Opinion_aquaculture)
chisq_aq_2 <- chisq.test(aq_chisq_table_2)
expected_aq_2 <- round(chisq_aq_2$expected, 1)

#ChiSquare to match reporting in the paper where neutral and not sure are collapsed into one column.
know_little_aq <- c(31, 194, 105)
very_somewhat_aq <- c(66, 116, 248)
table_aq_2 <- as.matrix(rbind(know_little_aq, very_somewhat_aq))
chisq_aq_paper <- chisq.test(table_aq_2)
chisq_2_exp_paper <- round(chisq_aq_paper$expected, 1)

#Extra comparison: familiarity with marine aquaculture and seaweed farming
table(survey_3$Familiarity_aq_factor)

#create a contingency table
fam_aq <- c(104, 330, 314, 116)
fam_sw <- c(212, 329, 222, 98)
fam <- c("never", "little", "somewhat", "very")
table_fam <- as.matrix(rbind(fam_aq, fam_sw))
fam_chisq <- chisq.test(table_fam)
expected_fam <- round(fam_chisq$expected, 1)
```

##Pre- and Post- opinion analyses (MA and SW surveys)
```{r, ChiSq on pre-post opinion, include = FALSE}
#remove the 'never heard of it' grouping from these analyses -- reported separately.
prepost_sw_chisq <- survey_3 %>%
  dplyr::filter(Familiarity_sw_factor != 'Never heard of it')
table(prepost_sw_chisq$Opinion_seaweed)
prepost_sw_chisq <- prepost_sw_chisq %>%
  dplyr::filter(Opinion_seaweed != 7)

prepost_sw_table <- table(prepost_sw_chisq$Opinion_seaweed, prepost_sw_chisq$Opinion_seaweed_post)
table(prepost_sw_chisq$Opinion_seaweed_post)
table(prepost_sw_chisq$Opinion_seaweed)

#3 responses from the pre-opinion question are removed because they did not respond with a post-opinion of seaweed farming.
pre <- c(47, 204, 339, 54)
post <- c(19, 58, 561, 6)
op <- c(1, 2, 3, 4)
pre_post_sw_data <- as.matrix(rbind(pre, post))
pre_post_sw_chi <- chisq.test(pre_post_sw_data)
expected_prepost_sw <- round(pre_post_sw_chi$expected, 1)

#same process for aquaculture and pre- post scores
table(survey_2$Opinion_aqua_pre)
table(survey_2$Opinion_aqua_post)

pre_aq <- c(19, 50, 69, 15)
post_aq <- c(11, 31, 109, 2)
op_aq <- c(1, 2, 3, 4)
pre_post_ma_data <- as.matrix(rbind(pre_aq, post_aq))
pre_post_ma_chi <- chisq.test(pre_post_ma_data)
expected_prepost_ma <- round(pre_post_ma_chi$expected, 1)

```

##Message Testing data and analyses (MA and SW surveys)
```{r, ChiSq on message testing, include = FALSE}

####MA survey message testing####
s2_m3 <- survey_2 %>%
  dplyr::select(c("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Opinion_aqua_pre"))

#Remove NAs - final n = 153
s2_m3 <- mutate_all(s2_m3, na_if, '#NULL!') 
s2_m3 <- s2_m3[complete.cases(s2_m3),]
table(s2_m3$Opinion_aqua_pre)
#group opinion into unfavorable, neutral, favorable
s2_m3$Opinion_aqua_pre <- case_when(
  s2_m3$Opinion_aqua_pre %% 4 == 0 ~ "Not sure",
  s2_m3$Opinion_aqua_pre %% 3 == 0 ~ "Favorable opinion of marine aquaculture",
  s2_m3$Opinion_aqua_pre %% 2 == 0 ~ "Neutral",
  s2_m3$Opinion_aqua_pre %% 1 == 0 ~ "Unfavorable opinion of marine aquaculture"
)

#long-form
s2_m3_long <- s2_m3 %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

s2_m3_long$rank = as.numeric(s2_m3_long$rank)

#Transform message "rank" into 1 = weak, 2 = neutral, 3 = strong:
s2_m3_long$rank <- case_when(
  s2_m3_long$rank %% 10 == 0 ~3,
  s2_m3_long$rank %% 9 == 0 ~ 3,
  s2_m3_long$rank %% 8 == 0 ~ 3,
  s2_m3_long$rank %% 7 == 0 ~ 3,
  s2_m3_long$rank %% 6 == 0 ~ 2,
  s2_m3_long$rank %% 5 == 0 ~ 2,
  s2_m3_long$rank %% 4 == 0 ~ 1,
  s2_m3_long$rank %% 3 == 0 ~ 1,
  s2_m3_long$rank %% 2 == 0 ~ 1,
  s2_m3_long$rank %% 1 == 0 ~ 1)

#Pearson's Chi-squared test for independence:
data_m3_ma <- table(s2_m3_long$Message, s2_m3_long$rank)
chi_m3_ma <- chisq.test(data_m3_ma)
expected_m3_ma <- round(chi_m3_ma$expected, 1)

#Chi Square with just weak and strong (no neutral)
data_m3_ma2 <- s2_m3_long %>%
  dplyr::filter(s2_m3_long$rank != 2)

table_m3_ma2 <- table(data_m3_ma2$Message, data_m3_ma2$rank)
chi_m3_ma2 <- chisq.test(table_m3_ma2)
expected_m3_ma2 <- round(chi_m3_ma2$expected, 1)

####SW survey message testing####
s3_m3 <- survey_3 %>%
  dplyr::select("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Familiarity_seaweed", "Opinion_seaweed")

#final n = 861 -- 4 responses excluded for incomplete responses.
s3_m3 <- mutate_all(s3_m3, na_if, '#NULL!') 
s3_m3 <- s3_m3[complete.cases(s3_m3),]

#rename pre opinion to be group
colnames(s3_m3)[which(names(s3_m3) == "Opinion_seaweed")] <- "group"
table(s3_m3$group)
s3_m3$group <- case_when(
  s3_m3$group %% 7 == 0 ~ "Never heard",
  s3_m3$group %% 4 == 0 ~ "Not sure",
  s3_m3$group %% 3 == 0 ~ "Favorable opinion",
  s3_m3$group %% 2 == 0 ~ "Neutral",
  s3_m3$group %% 1 == 0 ~ "Unfavorable opinion")

table(s3_m3$Message_1)
s3_m3_long <- s3_m3 %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

s3_m3_long$rank = as.numeric(s3_m3_long$rank)
#Transform message "rank" into 1 = weak, 2 = neutral, 3 = strong
s3_m3_long$rank <- case_when(
  s3_m3_long$rank %% 10 == 0 ~ 3,
  s3_m3_long$rank %% 9 == 0 ~ 3,
  s3_m3_long$rank %% 8 == 0 ~ 3,
  s3_m3_long$rank %% 7 == 0 ~ 3,
  s3_m3_long$rank %% 6 == 0 ~ 2,
  s3_m3_long$rank %% 5 == 0 ~ 2,
  s3_m3_long$rank %% 4 == 0 ~ 1,
  s3_m3_long$rank %% 3 == 0 ~ 1,
  s3_m3_long$rank %% 2 == 0 ~ 1,
  s3_m3_long$rank %% 1 == 0 ~ 1)

#Pearson's Chi-squared test of independence.
data_m3_sw <- table(s3_m3_long$Message, s3_m3_long$rank)
chi_m3_sw <- chisq.test(data_m3_sw)
expected_m3_sw <- round(chi_m3_sw$expected, 1)

#Chi Square with just weak and strong (no neutral)
data_m3_sw2 <- s3_m3_long %>%
  dplyr::filter(s3_m3_long$rank != 2)

table_m3_sw2 <- table(data_m3_sw2$Message, data_m3_sw2$rank)
chi_m3_sw2 <- chisq.test(table_m3_sw2)
expected_m3_sw2 <- round(chi_m3_sw2$expected, 1)
```

```{r, ChiSq on baseline opinion groups for message testing, include = FALSE}

####MA survey message testing -- how each baseline opinion group ranked each message####

#use the data without the neutral category
s2_m3_long_clean <- s2_m3_long %>%
  dplyr::filter(rank != 2)

ma_message_1 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_1")

ma_message_2 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_2")

ma_message_3 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_3")

ma_message_4 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_4")

ma_message_5 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_5")

ma_message_6 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_6")

ma_message_7 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_7")

ma_message_8 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_8")

ma_message_9 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_9")

ma_message_10 <- s2_m3_long_clean %>%
  dplyr::filter(Message == "Message_10")

#Pearson's Chi-squared test for independence:
ma_m1_opinion <- table(ma_message_1$Opinion_aqua_pre, ma_message_1$rank)
ma_m1_chi <- chisq.test(ma_m1_opinion)
ma_m1_expected <- round(ma_m1_chi$expected, 1)
#Message 1 is not significant

ma_m2_opinion <- table(ma_message_2$Opinion_aqua_pre, ma_message_2$rank)
ma_m2_chi <- chisq.test(ma_m2_opinion)
ma_m2_expected <- round(ma_m2_chi$expected, 1)
#approximation may be incorrect (check on this) Message 2 may be significant

ma_m3_opinion <- table(ma_message_3$Opinion_aqua_pre, ma_message_3$rank)
ma_m3_chi <- chisq.test(ma_m3_opinion)
ma_m3_expected <- round(ma_m3_chi$expected, 1)
#Message 3 is not significant

ma_m4_opinion <- table(ma_message_4$Opinion_aqua_pre, ma_message_4$rank)
ma_m4_chi <- chisq.test(ma_m4_opinion)
ma_m4_expected <- round(ma_m4_chi$expected, 1)
#Message 4 is not significant

ma_m5_opinion <- table(ma_message_5$Opinion_aqua_pre, ma_message_5$rank)
ma_m5_chi <- chisq.test(ma_m5_opinion)
ma_m5_expected <- round(ma_m5_chi$expected, 1)
#Message 5 is not significant

ma_m6_opinion <- table(ma_message_6$Opinion_aqua_pre, ma_message_6$rank)
ma_m6_chi <- chisq.test(ma_m6_opinion)
ma_m6_expected <- round(ma_m6_chi$expected, 1)
#Message 6 is significant (0.0091)

ma_m7_opinion <- table(ma_message_7$Opinion_aqua_pre, ma_message_7$rank)
ma_m7_chi <- chisq.test(ma_m7_opinion)
ma_m7_expected <- round(ma_m7_chi$expected, 1)
#Message 7 is not significant

ma_m8_opinion <- table(ma_message_8$Opinion_aqua_pre, ma_message_8$rank)
ma_m8_chi <- chisq.test(ma_m8_opinion)
ma_m8_expected <- round(ma_m8_chi$expected, 1)
#Message 8 is not significant

ma_m9_opinion <- table(ma_message_9$Opinion_aqua_pre, ma_message_9$rank)
ma_m9_chi <- chisq.test(ma_m9_opinion)
ma_m9_expected <- round(ma_m9_chi$expected, 1)
#Message 9 is not significant

ma_m10_opinion <- table(ma_message_10$Opinion_aqua_pre, ma_message_10$rank)
ma_m10_chi <- chisq.test(ma_m10_opinion)
ma_m10_expected <- round(ma_m10_chi$expected, 1)
#Message 10 is not significant

####SW survey message testing -- how each baseline opinion group ranked each message####

#use the data without the neutral category
s3_m3_long_clean <- s3_m3_long %>%
  dplyr::filter(rank != 2)

sw_message_1 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_1")

sw_message_2 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_2")

sw_message_3 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_3")

sw_message_4 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_4")

sw_message_5 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_5")

sw_message_6 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_6")

sw_message_7 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_7")

sw_message_8 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_8")

sw_message_9 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_9")

sw_message_10 <- s3_m3_long_clean %>%
  dplyr::filter(Message == "Message_10")

#Pearson's Chi-squared test for independence:
sw_m1_opinion <- table(sw_message_1$group, sw_message_1$rank)
sw_m1_chi <- chisq.test(sw_m1_opinion)
sw_m1_expected <- round(sw_m1_chi$expected, 1)
#Message 1 is not significant

sw_m2_opinion <- table(sw_message_2$group, sw_message_2$rank)
sw_m2_chi <- chisq.test(sw_m2_opinion)
sw_m2_expected <- round(sw_m2_chi$expected, 1)
#Message 2 is significant (0.011)

sw_m3_opinion <- table(sw_message_3$group, sw_message_3$rank)
sw_m3_chi <- chisq.test(sw_m3_opinion)
sw_m3_expected <- round(sw_m3_chi$expected, 1)
#Message 3 is not significant

sw_m4_opinion <- table(sw_message_4$group, sw_message_4$rank)
sw_m4_chi <- chisq.test(sw_m4_opinion)
sw_m4_expected <- round(sw_m4_chi$expected, 1)
#Message 4 is not significant

sw_m5_opinion <- table(sw_message_5$group, sw_message_5$rank)
sw_m5_chi <- chisq.test(sw_m5_opinion)
sw_m5_expected <- round(sw_m5_chi$expected, 1)
#Message 5 is not significant

sw_m6_opinion <- table(sw_message_6$group, sw_message_6$rank)
sw_m6_chi <- chisq.test(sw_m6_opinion)
sw_m6_expected <- round(sw_m6_chi$expected, 1)
#Message 6 is not significant

sw_m7_opinion <- table(sw_message_7$group, sw_message_7$rank)
sw_m7_chi <- chisq.test(sw_m7_opinion)
sw_m7_expected <- round(sw_m7_chi$expected, 1)
#Message 7 is not significant

sw_m8_opinion <- table(sw_message_8$group, sw_message_8$rank)
sw_m8_chi <- chisq.test(sw_m8_opinion)
sw_m8_expected <- round(sw_m8_chi$expected, 1)
#Message 8 is not significant

sw_m9_opinion <- table(sw_message_9$group, sw_message_9$rank)
sw_m9_chi <- chisq.test(sw_m9_opinion)
sw_m9_expected <- round(sw_m9_chi$expected, 1)
#Message 9 is significant (0.013)

sw_m10_opinion <- table(sw_message_10$group, sw_message_10$rank)
sw_m10_chi <- chisq.test(sw_m10_opinion)
sw_m10_expected <- round(sw_m10_chi$expected, 1)
#Message 10 is not significant
```

##Data transformations for figures (MA and SW surveys)
```{r, Data transformations for Figure 1a-b, echo=FALSE}

#select necessary columns from SW survey data and remove incomplete responses 
sw_plot_data <- survey_3 %>%
  dplyr::select(Opinion_seaweed, Opinion_seaweed_post, Familiarity_sw_factor)
sw_plot_data <- mutate_all(sw_plot_data, na_if, '#NULL!') 
sw_plot_data <- sw_plot_data[complete.cases(sw_plot_data),]

#Final n = 857 complete responses
opinion_pre_data <- sw_plot_data %>%
  dplyr::select(Opinion_seaweed, Familiarity_sw_factor)
table(opinion_pre_data)
opinion_post_data <- sw_plot_data %>%
  dplyr::select(Opinion_seaweed_post, Familiarity_sw_factor)

table(opinion_post_data$Opinion_seaweed_post)
#remove never heard of seaweed farming category
opinion_pre_data <- opinion_pre_data %>%
  dplyr::filter(Familiarity_sw_factor != "Never heard of it")
table(opinion_pre_data$Opinion_seaweed)
#remove the 2 that responded 'never heard' in the opinion question
opinion_pre_data <- opinion_pre_data %>%
  dplyr::filter(Opinion_seaweed != "7")

opinion_post_data <- opinion_post_data %>%
  dplyr::filter(Familiarity_sw_factor != "Never heard of it")
table(opinion_post_data$Familiarity_sw_factor)

#rename opinion to favorable, unfavorable, neutral, and not sure.
table(opinion_pre_data$Opinion_seaweed)
opinion_pre_data$Opinion_seaweed <- case_when(
  opinion_pre_data$Opinion_seaweed %% 4 == 0 ~ "Not sure",
  opinion_pre_data$Opinion_seaweed %% 3 == 0 ~ "Favorable",
  opinion_pre_data$Opinion_seaweed %% 3 == 0 ~ "Favorable",
  opinion_pre_data$Opinion_seaweed %% 2 == 0 ~ "Neutral",
  opinion_pre_data$Opinion_seaweed %% 1 == 0 ~ "Unfavorable",
  opinion_pre_data$Opinion_seaweed %% 1 == 0 ~ "Unfavorable")

table(opinion_post_data$Opinion_seaweed_post)
opinion_post_data$Opinion_seaweed_post = as.numeric(opinion_post_data$Opinion_seaweed_post)

opinion_post_data$Opinion_seaweed_post <- case_when(
  opinion_post_data$Opinion_seaweed_post %% 4 == 0 ~ "Not sure",
  opinion_post_data$Opinion_seaweed_post %% 3 == 0 ~ "Favorable",
  opinion_post_data$Opinion_seaweed_post %% 3 == 0 ~ "Favorable",
  opinion_post_data$Opinion_seaweed_post %% 2 == 0 ~ "Neutral",
  opinion_post_data$Opinion_seaweed_post %% 1 == 0 ~ "Unfavorable",
  opinion_post_data$Opinion_seaweed_post %% 1 == 0 ~ "Unfavorable")

#tables for pre and post
table_sw_pre <- opinion_pre_data %>%
  group_by(Familiarity_sw_factor, Opinion_seaweed) %>%
  summarise(count = n())
table(opinion_pre_data$Familiarity_sw_factor)

table_sw_pre$group_n <- case_when(
    table_sw_pre$Familiarity_sw_factor == "Heard of it but know little about it" ~ "325",
  table_sw_pre$Familiarity_sw_factor == "Somewhat familiar" ~ "221",
  table_sw_pre$Familiarity_sw_factor == "Very familiar" ~ "98")

table_sw_pre$count = as.numeric(table_sw_pre$count)
table_sw_pre$group_n = as.numeric(table_sw_pre$group_n)
table_sw_pre$rel.freq <- table_sw_pre$count / table_sw_pre$group_n

table_sw_post <- opinion_post_data %>%
  group_by(Familiarity_sw_factor, Opinion_seaweed_post) %>%
  summarise(count = n())

table(opinion_post_data$Familiarity_sw_factor)
table_sw_post$group_n <- case_when(
    table_sw_post$Familiarity_sw_factor == "Heard of it but know little about it" ~ "327",
  table_sw_post$Familiarity_sw_factor == "Somewhat familiar" ~ "221",
  table_sw_post$Familiarity_sw_factor == "Very familiar" ~ "98")

table_sw_post$count = as.numeric(table_sw_post$count)
table_sw_post$group_n = as.numeric(table_sw_post$group_n)
table_sw_post$rel.freq <- table_sw_post$count / table_sw_post$group_n
#remove the NAs
table_sw_post <- table_sw_post[complete.cases(table_sw_post),]
#rename opinion columns into opinion
table_sw_pre$Opinion = table_sw_pre$Opinion_seaweed
table_sw_post$Opinion = table_sw_post$Opinion_seaweed_post
table_sw_pre <- table_sw_pre %>% dplyr::select(-Opinion_seaweed)
table_sw_post <- table_sw_post %>% dplyr::select(-Opinion_seaweed_post)

#create a pre/post column for each
table_sw_pre$video <- "Baseline opinion"
table_sw_post$video <- "Post-opinion"

#bind the two datasets
sw_graph_data <- rbind(table_sw_pre, table_sw_post)
colnames(sw_graph_data)[which(names(sw_graph_data) == "Familiarity_sw_factor")] <- "group"

#frequency data for never heard of seaweed farming group
unknown <- survey_3 %>%
  dplyr::select(Opinion_seaweed_post, Familiarity_sw_factor)

unknown <- unknown %>%
  dplyr::filter(Familiarity_sw_factor == "Never heard of it")
unknown <- unknown[complete.cases(unknown),]
table(unknown$Opinion_seaweed_post)
unknown$Opinion_seaweed_post = as.numeric(unknown$Opinion_seaweed_post)
unknown$Opinion_seaweed_post <- case_when(
  unknown$Opinion_seaweed_post %% 4 == 0 ~ "Not sure",
  unknown$Opinion_seaweed_post %% 3 == 0 ~ "Favorable",
  unknown$Opinion_seaweed_post %% 3 == 0 ~ "Favorable",
  unknown$Opinion_seaweed_post %% 2 == 0 ~ "Neutral",
  unknown$Opinion_seaweed_post %% 1 == 0 ~ "Unfavorable",
  unknown$Opinion_seaweed_post %% 1 == 0 ~ "Unfavorable")

unknown <- unknown %>%
  group_by(Opinion_seaweed_post) %>%
  summarise(count = n())
#People that have never heard of seaweed farming: n = 212 but one did not respond with a post-opinion
unknown$group_n = as.numeric(211)
unknown$count = as.numeric(unknown$count)
unknown$rel.freq <- unknown$count / unknown$group_n
#rename opinion column
colnames(unknown)[which(names(unknown) == "Opinion_seaweed_post")] <- "Opinion"
unknown$Opinion <- fct_relevel(unknown$Opinion, c("Not sure", "Unfavorable", "Neutral", "Favorable"))

unknown$group <- "Never heard of it"
unknown$video <- "Post-opinion"

sw_graph_data <- rbind(sw_graph_data, unknown)


```

```{r, Data transformations for Figure 2a-b, echo = FALSE}
#Data for coastal states only#
s2_data <- survey_2 %>%
  dplyr::select(c("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Opinion_aqua_pre", "Region_s3"))

#Remove NAs - final n = 153
s2_data <- mutate_all(s2_data, na_if, '#NULL!') 
s2_data <- s2_data[complete.cases(s2_data),]
table(s2_data$Opinion_aqua_pre)
#group opinion into unfavorable, neutral, favorable
s2_data$Opinion_aqua_pre <- case_when(
  s2_data$Opinion_aqua_pre %% 3 == 0 ~ "Favorable",
  s2_data$Opinion_aqua_pre %% 3 == 0 ~ "Favorable",
  s2_data$Opinion_aqua_pre %% 2 == 0 ~ "Not sure/Neutral",
  s2_data$Opinion_aqua_pre %% 1 == 0 ~ "Unfavorable",
  s2_data$Opinion_aqua_pre %% 1 == 0 ~ "Unfavorable"
)

#Mutate to long-form data
s2_data <- s2_data %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')


#Set up rankings to be in three categories: strong, neutral, weak:
s2_data$rank_factor <- case_when(
     s2_data$rank %% 10 == 0 ~ "strong reason",
     s2_data$rank %% 9 == 0 ~ "strong reason",
     s2_data$rank %% 8 == 0 ~ "strong reason",
     s2_data$rank %% 7 == 0 ~ "strong reason",
     s2_data$rank %% 6 == 0 ~ "neutral reason",
     s2_data$rank %% 5 == 0 ~ "neutral reason",
     s2_data$rank %% 4 == 0 ~ "weak reason",
     s2_data$rank %% 3 == 0 ~ "weak reason",
     s2_data$rank %% 2 == 0 ~ "weak reason",
     s2_data$rank %% 1 == 0 ~ "weak reason")

#Supplemental table S4 in paper
table(s2_data$rank_factor, s2_data$Message)

#Frequencies for heat map
#Group by Message, group, and rank_factor to get frequency table

s2_table <- s2_data %>%
  group_by(rank_factor, Message, Opinion_aqua_pre) %>%
  summarise(count = n())

s2_table$group_n <- case_when(
    s2_table$Opinion_aqua_pre == "Favorable" ~ "69", 
  s2_table$Opinion_aqua_pre == "Not sure/Neutral" ~ "65", 
  s2_table$Opinion_aqua_pre == "Unfavorable" ~ "19")

s2_table$count = as.numeric(s2_table$count)
s2_table$group_n = as.numeric(s2_table$group_n)
s2_table$rel.freq <- s2_table$count / s2_table$group_n

s2_graph_data <- s2_table

#remove the neutral reason group for simplified graph
s2_graph_data <- s2_graph_data %>%
  dplyr::filter(rank_factor != "neutral reason")

#new column with colors needed in the tiles -- new plot
s2_graph_data$color <- case_when(
  s2_graph_data$Message == "Message_10" ~ "Environmental",
  s2_graph_data$Message == "Message_9" ~ "Social",
  s2_graph_data$Message == "Message_8" ~ "Environmental",
  s2_graph_data$Message == "Message_7" ~ "Social and Environmental",
  s2_graph_data$Message == "Message_6" ~ "Environmental",
  s2_graph_data$Message == "Message_5" ~ "Social",
  s2_graph_data$Message == "Message_4" ~ "Social and Economic",
  s2_graph_data$Message == "Message_3" ~ "Economic",
  s2_graph_data$Message == "Message_2" ~ "Economic",
  s2_graph_data$Message == "Message_1" ~ "Economic")

s2_graph_data$Opinion_aqua_pre = fct_relevel(s2_graph_data$Opinion_aqua_pre, c("Unfavorable", "Not sure/Neutral", "Favorable"))

s2_graph_data$rank_factor = fct_relevel(s2_graph_data$rank_factor, c("weak reason", "strong reason"))

#Survey 3 data for heat map plot without resistant group
s3_data <- survey_3 %>%
  dplyr::select(c("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Opinion_seaweed"))
table(survey_3$Opinion_seaweed)

#Remove NAs - final total n = 865
s3_data <- mutate_all(s3_data, na_if, '#NULL!')
s3_data <- s3_data[complete.cases(s3_data),]

#group opinion into unfavorable, neutral, favorable, never heard
s3_data$Opinion_seaweed <- case_when(
  s3_data$Opinion_seaweed %% 7 == 0 ~ "Never heard",
  s3_data$Opinion_seaweed %% 4 == 0 ~ "Not sure",
  s3_data$Opinion_seaweed %% 3 == 0 ~ "Favorable",
  s3_data$Opinion_seaweed %% 3 == 0 ~ "Favorable",
  s3_data$Opinion_seaweed %% 2 == 0 ~ "Neutral",
  s3_data$Opinion_seaweed %% 1 == 0 ~ "Unfavorable",
  s3_data$Opinion_seaweed %% 1 == 0 ~ "Unfavorable"
)

table(s3_data$Opinion_seaweed)

#Mutate to long-form data
s3_data <- s3_data %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

#Set up rankings to be in three categories: strong, neutral, weak:
s3_data$rank_factor <- case_when(
     s3_data$rank %% 10 == 0 ~ "strong reason",
     s3_data$rank %% 9 == 0 ~ "strong reason",
     s3_data$rank %% 8 == 0 ~ "strong reason",
     s3_data$rank %% 7 == 0 ~ "strong reason",
     s3_data$rank %% 6 == 0 ~ "neutral reason",
     s3_data$rank %% 5 == 0 ~ "neutral reason",
     s3_data$rank %% 4 == 0 ~ "weak reason",
     s3_data$rank %% 3 == 0 ~ "weak reason",
     s3_data$rank %% 2 == 0 ~ "weak reason",
     s3_data$rank %% 1 == 0 ~ "weak reason")

#Supplemental table S4 in paper
table(s3_data$rank_factor, s3_data$Message)

#Frequencies for heat map

#Frequency table for each grouping
s3_graph_data <- s3_data %>%
  group_by(rank_factor, Message, Opinion_seaweed) %>%
  summarise(count = n())

s3_graph_data$group_n <- case_when(
  s3_graph_data$Opinion_seaweed == "Favorable" ~ "338",
  s3_graph_data$Opinion_seaweed == "Neutral" ~ "205",
  s3_graph_data$Opinion_seaweed == "Never heard" ~ "218",
  s3_graph_data$Opinion_seaweed == "Not sure" ~ "55",
  s3_graph_data$Opinion_seaweed == "Unfavorable" ~ "48")

s3_graph_data$count = as.numeric(s3_graph_data$count)
s3_graph_data$group_n = as.numeric(s3_graph_data$group_n)
s3_graph_data$rel.freq <- s3_graph_data$count / s3_graph_data$group_n

#new column with colors needed in the tiles
s3_graph_data$color <- case_when(
  s3_graph_data$Message == "Message_10" ~ "Social",
  s3_graph_data$Message == "Message_9" ~ "Environmental",
  s3_graph_data$Message == "Message_8" ~ "Economic and Environmental",
  s3_graph_data$Message == "Message_7" ~ "Economic",
  s3_graph_data$Message == "Message_6" ~ "Economic",
  s3_graph_data$Message == "Message_5" ~ "Social",
  s3_graph_data$Message == "Message_4" ~ "Economic",
  s3_graph_data$Message == "Message_3" ~ "Environmental",
  s3_graph_data$Message == "Message_2" ~ "Environmental",
  s3_graph_data$Message == "Message_1" ~ "Environmental")

#remove the neutral reason group for simplified graph
s3_graph_data <- s3_graph_data %>%
  dplyr::filter(rank_factor != "neutral reason")

s3_graph_data$Opinion_seaweed <- fct_relevel(s3_graph_data$Opinion_seaweed, c("Never heard", "Not sure", "Unfavorable", "Neutral", "Favorable"))

s3_graph_data$rank_factor = fct_relevel(s3_graph_data$rank_factor, c("weak reason", "strong reason"))

```

```{r, Data for Figure 3, include = FALSE}

#Trust data messy code from trust question tables
source <- c("Scientists", "Seafood farmers", "Fishermen", "Aquariums & museums", "Nongovernment organizations (NGOs)", "Professional chefs", "Government organizations", "Grocer or fish monger")
group <- c("Trust (4-5)", "Trust (4-5)", "Trust (4-5)", "Trust (4-5)", "Trust (4-5)", "Trust (4-5)", "Trust (4-5)", "Trust (4-5)")
freq_3 <- c(0.76, 0.60, 0.60, 0.60, 0.45, 0.44, 0.35, 0.23)
color <- c(">50% Trust", ">50% Trust",">50% Trust",">50% Trust", "<50% Trust", "<50% Trust","<50% Trust","<50% Trust")

trust_data <- as.data.frame(cbind(source, group, freq_3, color))
str(trust_data)
trust_data$freq_3 = as.numeric(trust_data$freq_3)
trust_data$source = as.factor(trust_data$source)
trust_data$group = as.factor(trust_data$group)
trust_data$color = as.factor(trust_data$color)
```

##Code for figures (MA and SW surveys)
```{r, Figure 1a-b, echo = FALSE}
sw_graph_data$Opinion <- fct_relevel(sw_graph_data$Opinion, c("Not sure", "Unfavorable", "Neutral", "Favorable"))
sw_graph_data$group <- fct_relevel(sw_graph_data$group, c("Never heard of it", "Heard of it but know little about it", "Somewhat familiar", "Very familiar"))
sw_graph_data$video <- fct_relevel(sw_graph_data$video, c("Baseline opinion", "Post-opinion"))

sw_plot <- ggplot(data = sw_graph_data,
                mapping = aes(x = group, y = rel.freq, fill = Opinion
                )) +
  geom_bar(width = 0.6, position = "stack", stat = "identity", colour = "white", size = 0.1) +
  facet_grid(~video) +
  scale_fill_viridis_d(direction = -1) +
  xlab("Baseline familiarity") +
  ylab("Percent") +
  ggtitle("Opinions of seaweed farming pre- and post- intervention") +
  theme_bw() +
  theme(legend.position = "bottom") +
  theme(aspect.ratio = 1/1.8)

sw_plot <- sw_plot + coord_flip()
ggsave("sw_plot.png", dpi = 600)

```

```{r, Figure 2a, echo = FALSE}

s2_graph_data$color <- fct_relevel(s2_graph_data$color, c("Environmental", "Social and Environmental", "Social", "Social and Economic", "Economic"))

s2_graph_data$Message <- fct_relevel(s2_graph_data$Message, c("Message_3", "Message_2", "Message_1","Message_4","Message_9","Message_5","Message_7","Message_6","Message_8","Message_10"))

s2_heat_map_group <- ggplot(s2_graph_data, aes(y = Message, x = Opinion_aqua_pre, fill = color, alpha = rel.freq)) +
  geom_tile(colour = "white", size = 0.05) +
  facet_grid(~rank_factor) +
  theme_bw() +
  scale_fill_manual(values = c("Environmental" = "#006400", "Social and Economic" = "#8B0000", "Social" = "#440154FF", "Economic" = "#21908CFF", "Social and Environmental" = "#e1b941")) +
  scale_alpha_continuous(breaks = c(0.2, 0.4, 0.6, 0.8)) +
  theme(panel.grid = element_blank()) +
  coord_cartesian(expand = FALSE) +
   theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.text.y = element_text(size=6),
        plot.background = element_rect(fill='transparent'),
        strip.text.y = element_text(size=6)) +
  theme(axis.title = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_blank()) +
  labs(fill = "Message Theme", alpha = "Percent Occurrence Gradient")

s2_heat_map_no_legend <- s2_heat_map_group + theme(legend.position = "none")

ggsave("s2_heat_map_group.png", plot = s2_heat_map_no_legend, width = 6, height = 7, units = "in", dpi = 600)

ggsave("s2_heat_map_legend.png", plot = s2_heat_map_group, dpi = 600)

```

```{r, Figure 2b, echo = FALSE}

s3_graph_data$color <- fct_relevel(s3_graph_data$color, c("Environmental","Economic and Environmental", "Social", "Economic"))

s3_graph_data$Message <- fct_relevel(s3_graph_data$Message, c("Message_6", "Message_7", "Message_4","Message_10","Message_5","Message_8","Message_9","Message_3","Message_2","Message_1"))

s3_heat_map_group <- ggplot(s3_graph_data, aes(y = Message, x = Opinion_seaweed, fill = color, alpha = rel.freq)) +
  geom_tile(colour = "white", size = 0.05) +
  facet_grid(~rank_factor) +
  theme_bw() +
 scale_fill_manual(values = c("Environmental" = "#006400", "Social" = "#440154FF", "Economic" = "#21908CFF", "Economic and Environmental" = "#d86c00")) +
  scale_alpha_continuous(breaks = c(0.2, 0.4, 0.6, 0.8)) +
  theme(panel.grid = element_blank()) +
  coord_cartesian(expand = FALSE) +
   theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.text.y = element_text(size=5),
        strip.text.y = element_text(size=6)) + 
  theme(axis.title = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_blank()) +
  labs(fill = "Theme", alpha = "Percent gradient") 

s3_heat_map_no_legend <- s3_heat_map_group + theme(legend.position = "none")

ggsave("s3_heat_map_group.png", width = 6, height = 7, units = "in", dpi = 600)

```

```{r, Figure 3, echo = FALSE}

trust_data$source <- fct_relevel(trust_data$source, c("Grocer or fish monger", "Government organizations", "Professional chefs", "Nongovernment organizations (NGOs)", "Seafood farmers", "Fishermen", "Aquariums & museums", "Scientists"))
trust_data$color <- fct_relevel(trust_data$color, c(">50% Trust", "<50% Trust"))

trust_plot <- ggplot(data = trust_data,
                mapping = aes(x = freq_3, y = source)) +
  geom_col(width = 0.75, position = "dodge2", colour = "black", size = 0.2) +
  xlim(0, 1.0)+
  xlab("Frequency of trust response (4-5)") +
  ylab("Source of information") +
  theme_bw() +
  theme(plot.title = element_blank()) +
    theme(legend.title = element_blank())  +
  theme(aspect.ratio = 1/1.8)

trust_plot
ggsave("trust_plot.png", dpi = 600)
```
##Sociodemographics (MA and SW surveys)
```{r, Sociodemographic ChiSquare on opinion for all surveys, include = FALSE}

#NOTE we looked at unfavorable and favorable opinions, removing neutral, not sure, and never heard. See regressions for full analyses which were also not significant. 

region_opinion_s2 <- survey_2 %>%
  dplyr::select(c(Opinion_aqua_pre, Region_s3))
table(region_opinion_s2$Opinion_aqua_pre)
#test favorable and unfavorable views
region_opinion_s2 <- region_opinion_s2 %>%
  dplyr::filter(Opinion_aqua_pre != 2)
region_opinion_s2 <- region_opinion_s2 %>%
  dplyr::filter(Opinion_aqua_pre != 4)

region_opinion_s2_table <- table(region_opinion_s2$Region_s3, region_opinion_s2$Opinion_aqua_pre)
region_chi <- chisq.test(region_opinion_s2_table)
#region is not significant

race_opinion_s2 <- survey_2 %>%
  dplyr::select(c(Opinion_aqua_pre, Race_factor))
race_opinion_s2 <- race_opinion_s2 %>%
  dplyr::filter(Opinion_aqua_pre != 2)
race_opinion_s2 <- race_opinion_s2 %>%
  dplyr::filter(Opinion_aqua_pre != 4)
table(race_opinion_s2$Opinion_aqua_pre)
race_opinion_s2_table <- table(race_opinion_s2$Race_factor, race_opinion_s2$Opinion_aqua_pre)
race_chi <- chisq.test(race_opinion_s2_table)
#Race is not significant but also heavily skewed towards White population
  
edu_opinion_s2 <-survey_2 %>%
  dplyr::select(c(Opinion_aqua_pre, Education_collapsed))
edu_opinion_s2 <- edu_opinion_s2 %>%
  dplyr::filter(Opinion_aqua_pre != 2)
edu_opinion_s2 <- edu_opinion_s2 %>%
  dplyr::filter(Opinion_aqua_pre != 4)
table(edu_opinion_s2$Opinion_aqua_pre)
edu_opinion_s2 <- table(edu_opinion_s2$Education_collapsed, edu_opinion_s2$Opinion_aqua_pre)
edu_chi <- chisq.test(edu_opinion_s2)
edu_expected <- round(edu_chi$expected, 1)
#significant (p=0.002) but also a skewed population towards specific bins


####Survey 3####
region_opinion_s3 <- survey_3 %>%
  dplyr::select(c(Opinion_seaweed, Region_factor))
table(region_opinion_s3$Opinion_seaweed)
#test favorable and unfavorable views
region_opinion_s3 <- region_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 2)
region_opinion_s3 <- region_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 4)
region_opinion_s3 <- region_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 7)

region_opinion_s3_table <- table(region_opinion_s3$Region_factor, region_opinion_s3$Opinion_seaweed)
region_chi_sw <- chisq.test(region_opinion_s3_table)
#region is not significant

race_opinion_s3 <- survey_3 %>%
  dplyr::select(c(Opinion_seaweed, Race_factor))
race_opinion_s3 <- race_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 2)
race_opinion_s3 <- race_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 4)
race_opinion_s3 <- race_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 7)
table(race_opinion_s3$Opinion_seaweed)
race_opinion_s3_table <- table(race_opinion_s3$Race_factor, race_opinion_s3$Opinion_seaweed)
race_chi_sw <- chisq.test(race_opinion_s3_table)
#Race is not significant but also heavily skewed towards White population
  
edu_opinion_s3 <-survey_3 %>%
  dplyr::select(c(Opinion_seaweed, Education_collapsed))
edu_opinion_s3 <- edu_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 2)
edu_opinion_s3 <- edu_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 4)
edu_opinion_s3 <- edu_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 7)
table(edu_opinion_s3$Opinion_seaweed)
edu_opinion_s3 <- table(edu_opinion_s3$Education_collapsed, edu_opinion_s3$Opinion_seaweed)
edu_chi_sw <- chisq.test(edu_opinion_s3)
#Education is not significant and is also skewed.

age_opinion_s3 <-survey_3 %>%
  dplyr::select(c(Opinion_seaweed, Age_factor))
age_opinion_s3 <- age_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 2)
age_opinion_s3 <- age_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 4)
age_opinion_s3 <- age_opinion_s3 %>%
  dplyr::filter(Opinion_seaweed != 7)
table(age_opinion_s3$Opinion_seaweed)
age_opinion_s3 <- table(age_opinion_s3$Age_factor, age_opinion_s3$Opinion_seaweed)
age_chi_sw <- chisq.test(age_opinion_s3)
#age is not significant here.

##Survey 3 opinion aquaculture
region_op_aq_s3 <- survey_3 %>%
  dplyr::select(c(Opinion_aquaculture, Region_factor))
table(region_op_aq_s3$Opinion_aquaculture)
#test favorable and unfavorable views
region_op_aq_s3 <- region_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 2)
region_op_aq_s3 <- region_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 4)
region_op_aq_s3 <- region_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 7)

region_op_aq_table <- table(region_op_aq_s3$Region_factor, region_op_aq_s3$Opinion_aquaculture)
region_chi_aq_s3 <- chisq.test(region_op_aq_table)
#region is not significant

race_op_aq_s3 <- survey_3 %>%
  dplyr::select(c(Opinion_aquaculture, Race_factor))
race_op_aq_s3 <- race_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 2)
race_op_aq_s3 <- race_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 4)
race_op_aq_s3 <- race_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 7)
table(race_op_aq_s3$Opinion_aquaculture)
race_op_aq_table <- table(race_op_aq_s3$Race_factor, race_op_aq_s3$Opinion_aquaculture)
race_chi_aq_s3 <- chisq.test(race_op_aq_table)
#Race is not significant but also heavily skewed towards White population
  
edu_op_aq_s3 <-survey_3 %>%
  dplyr::select(c(Opinion_aquaculture, Education_collapsed))
edu_op_aq_s3 <- edu_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 2)
edu_op_aq_s3 <- edu_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 4)
edu_op_aq_s3 <- edu_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 7)
table(edu_op_aq_s3$Opinion_aquaculture)
edu_op_aq_s3_table <- table(edu_op_aq_s3$Education_collapsed, edu_op_aq_s3$Opinion_aquaculture)
edu_chi_aq_s3 <- chisq.test(edu_op_aq_s3_table)
expected_edu_chi_aq_s3 <- round(edu_chi_aq_s3$expected, 1)

#Education is significant but also heavily skewed towards a couple of education bins (p = 0.02)

age_op_aq_s3 <-survey_3 %>%
  dplyr::select(c(Opinion_aquaculture, Age_factor))
age_op_aq_s3 <- age_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 2)
age_op_aq_s3 <- age_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 4)
age_op_aq_s3 <- age_op_aq_s3 %>%
  dplyr::filter(Opinion_aquaculture != 7)
table(age_op_aq_s3$Opinion_aquaculture)
age_op_aq_s3_table <- table(age_op_aq_s3$Age_factor, age_op_aq_s3$Opinion_aquaculture)
age_chi_aq_s3 <- chisq.test(age_op_aq_s3_table)
expected_age_chi_aq_s3 <- round(age_chi_aq_s3$expected, 1)
#Age is significant (p = 0.00735)

```

```{r, Sociodemographic ChiSquare on familiarity (SW survey only), include = FALSE}
familiarity_data <- survey_3
table(survey_3$Familiarity_seaweed)
#test just never heard and have heard of
familiarity_data$Familiarity_seaweed <- case_when(
  familiarity_data$Familiarity_seaweed %% 4 == 0 ~ 2,
  familiarity_data$Familiarity_seaweed %% 3 == 0 ~ 2,
  familiarity_data$Familiarity_seaweed %% 2 == 0 ~ 2,
  familiarity_data$Familiarity_seaweed %% 1 == 0 ~ 1)
table(familiarity_data$Familiarity_seaweed)

familiarity_data$Familiarity_aquaculture <- case_when(
  familiarity_data$Familiarity_aquaculture %% 4 == 0 ~ 2,
  familiarity_data$Familiarity_aquaculture %% 3 == 0 ~ 2,
  familiarity_data$Familiarity_aquaculture %% 2 == 0 ~ 2,
  familiarity_data$Familiarity_aquaculture %% 1 == 0 ~ 1)
table(familiarity_data$Familiarity_aquaculture)

region_familiarity_sw <- familiarity_data %>%
  dplyr::select(c(Familiarity_seaweed, Region_factor))
table(region_familiarity_sw$Familiarity_seaweed)

region_familiarity_sw_table <- table(region_familiarity_sw$Region_factor, region_familiarity_sw$Familiarity_seaweed)
region_chi_sw_fam <- chisq.test(region_familiarity_sw_table)
#region is not significant

race_familiarity_sw <- familiarity_data %>%
  dplyr::select(c(Familiarity_seaweed, Race_factor))
table(race_familiarity_sw$Familiarity_seaweed)
race_familiarity_sw_table <- table(race_familiarity_sw$Race_factor, race_familiarity_sw$Familiarity_seaweed)
race_chi_familiarity_sw <- chisq.test(race_familiarity_sw_table)
#Race is not significant but also heavily skewed towards White population
  
edu_familiarity_sw <-familiarity_data %>%
  dplyr::select(c(Familiarity_seaweed, Education_collapsed))
table(edu_familiarity_sw$Familiarity_seaweed)
edu_familiarity_sw_table <- table(edu_familiarity_sw$Education_collapsed, edu_familiarity_sw$Familiarity_seaweed)
edu_chi_familiarity_sw <- chisq.test(edu_familiarity_sw_table)
#Education is significant (p = 0.0001787).
expected_familiarity_edu_sw <- round(edu_chi_familiarity_sw$expected, 1)

age_familiarity_sw <-familiarity_data %>%
  dplyr::select(c(Familiarity_seaweed, Age_factor))
table(age_familiarity_sw$Familiarity_seaweed)
age_familiarity_sw_table <- table(age_familiarity_sw$Age_factor, age_familiarity_sw$Familiarity_seaweed)
age_chi_familiarity_sw <- chisq.test(age_familiarity_sw_table)
#Age is not significant

##Survey 3 familiarity marine aquaculture
region_familiarity_aq <- familiarity_data %>%
  dplyr::select(c(Familiarity_aquaculture, Region_factor))
table(region_familiarity_aq$Familiarity_aquaculture)

region_familiarity_aq_table <- table(region_familiarity_aq$Region_factor, region_familiarity_aq$Familiarity_aquaculture)
region_chi_familiarity_aq <- chisq.test(region_familiarity_aq_table)
#region is not significant

race_familiarity_aq <- familiarity_data %>%
  dplyr::select(c(Familiarity_aquaculture, Race_factor))

table(race_familiarity_aq$Familiarity_aquaculture)
race_familiarity_aq_table <- table(race_familiarity_aq$Race_factor, race_familiarity_aq$Familiarity_aquaculture)
race_chi_familiarity_aq <- chisq.test(race_familiarity_aq_table)
#Race is not significant but also heavily skewed towards White population
  
edu_familiarity_aq <-familiarity_data %>%
  dplyr::select(c(Familiarity_aquaculture, Education_collapsed))

table(edu_familiarity_aq$Familiarity_aquaculture)
edu_familiarity_aq_table <- table(edu_familiarity_aq$Education_collapsed, edu_familiarity_aq$Familiarity_aquaculture)
edu_chi_familiarity_aq <- chisq.test(edu_familiarity_aq_table)
expected_chi_familiarity_aq <- round(edu_chi_familiarity_aq$expected, 1)
#education is significant (p = 0.0054) but data is skewed towards specific bins

age_familiarity_aq <-familiarity_data %>%
  dplyr::select(c(Familiarity_aquaculture, Age_factor))
table(age_familiarity_aq$Familiarity_aquaculture)
age_familiarity_aq_table <- table(age_familiarity_aq$Age_factor, age_familiarity_aq$Familiarity_aquaculture)
age_chi_familiarity_aq <- chisq.test(age_familiarity_aq_table)
#Age is not significant

```

##Other analyses -- Regressions and ANOVAs


Identifying Strong Messages in Support of Aquaculture

We used multilevel ordered logistic regressions and binomial logistic regressions to test variations in strength (rank 1-10) of each message (MA and SW tested separately). Two responses from the SW survey that did not answer necessary questions were removed. For the MA survey, we tested group characteristics as categorical predictors of rank order based on initial opinion of each sector (unfavorable, neutral/not sure, and favorable). Because we had the detailed levels of familiarity for the SW survey, we added “never heard of seaweed farming” as a factor level to our categorical predictor.

Our binomial logistic regression models met the assumptions of dispersion, outliers, and uniformity and fitted vs. residual plots were adequate.

Wilcoxon Tests
To assess how reported opinions of aquaculture changed after viewing videos, we performed Wilcoxon signed rank tests (R package rstatix) on our paired data. This nonparametric test was selected because our data is both ordinal and non-normal and all assumptions were met, given that the test provides a continuity correction. We compared the average response for each of the 6 videos watched in the MA survey, and for the SW survey video. We justify the use of mean (rather than median) given that we used our full six-point likert scale, as well as the fact that we have an appropriate sample size. We also calculated Wilcoxon effect sizes using the formula r = Z/√N where Z is the standardized test statistic and N is the number of response pairs.

```{r, Data for Wilcoxon tests on pre-post opinion, include = FALSE}

s2_wilcox <- survey_2 %>%
  dplyr::select(Opinion_aqua_pre, Opinion_aqua_post, VIDEOQUOTA)

#remove those that did not meet videoquota (n = 1)
s2_wilcox_clean <- s2_wilcox %>%
  dplyr::filter(VIDEOQUOTA != -2)
#remove incomplete responses (we need fully paired data)
s2_wilcox_clean <- s2_wilcox_clean[complete.cases(s2_wilcox_clean),]
table(s2_wilcox_clean$Opinion_aqua_post)

table(s2_wilcox_clean$VIDEOQUOTA)
#final n for our subsampled data = 154; video1 = 34, video2 = 28, video3 = 16, video4 = 26, video5 = 23, video6 = 26

#Neutral and Not Sure were not combined here. Need to re-order the levels
#1 = v.unfav, 2 = unfavorabl, 3 = not sure, 4 = neutral, 5 = fav, 6 = v.fav
table(s2_wilcox_clean$Opinion_aqua_pre)
s2_wilcox_clean$Opinion_aqua_pre = as.numeric(s2_wilcox_clean$Opinion_aqua_pre)

s2_wilcox_clean$VIDEOQUOTA = as.numeric(s2_wilcox_clean$VIDEOQUOTA)
s2_wilcox_clean$video_factor <- 
  case_when(
    s2_wilcox_clean$VIDEOQUOTA %% 6 == 0 ~ "Kanpachi Food Only",
    s2_wilcox_clean$VIDEOQUOTA %% 5 == 0 ~ "Kanpachi No Food",
    s2_wilcox_clean$VIDEOQUOTA %% 4 == 0 ~ "Standard Closing",
    s2_wilcox_clean$VIDEOQUOTA %% 3 == 0 ~ "Standard Intro",
    s2_wilcox_clean$VIDEOQUOTA %% 2 == 0 ~ "Mussels Food Only",
    s2_wilcox_clean$VIDEOQUOTA %% 1 == 0 ~ "Mussels No Food")
table(s2_wilcox_clean$video_factor)
s2_wilcox_pre <- s2_wilcox_clean %>%
  dplyr::select(video_factor, Opinion_aqua_pre)

s2_wilcox_post <- s2_wilcox_clean %>%
  dplyr::select(video_factor, Opinion_aqua_post)

s2_wilcox_pre$Opinion <- s2_wilcox_pre$Opinion_aqua_pre
s2_wilcox_pre$video = "Pre"
s2_wilcox_pre <- s2_wilcox_pre %>%
  dplyr::select(-Opinion_aqua_pre)

s2_wilcox_post$Opinion <- s2_wilcox_post$Opinion_aqua_post
s2_wilcox_post$video = "Post"
s2_wilcox_post <- s2_wilcox_post %>%
  dplyr::select(-Opinion_aqua_post)

#combine for long-form data
s2_wilcox_data <- rbind(s2_wilcox_pre, s2_wilcox_post)


#Data for seaweed video (survey 3)
s3_wilcox <- survey_3 %>%
  dplyr::select(Opinion_seaweed, Opinion_seaweed_post)

#remove those that had never heard of seaweed farming
s3_wilcox_clean <- s3_wilcox %>%
  dplyr::filter(Opinion_seaweed != 7)
table(s3_wilcox_clean$Opinion_seaweed)
#remove incomplete responses (we need fully paired data)
s3_wilcox_clean <- s3_wilcox_clean[complete.cases(s3_wilcox_clean),]
#final n = 644

#Neutral and Not Sure were not combined here. 
#1 = unfavorable, 2 = neutral, 3 = favorable, 4 = not sure
table(s3_wilcox_clean$Opinion_seaweed)


table(s3_wilcox_clean$Opinion_seaweed_post)

s3_wilcox_pre <- s3_wilcox_clean %>%
  dplyr::select(Opinion_seaweed)

s3_wilcox_post <- s3_wilcox_clean %>%
  dplyr::select(Opinion_seaweed_post)

s3_wilcox_pre$Opinion <- s3_wilcox_pre$Opinion_seaweed
s3_wilcox_pre$video = "Pre"
s3_wilcox_pre <- s3_wilcox_pre %>%
  dplyr::select(-Opinion_seaweed)

s3_wilcox_post$Opinion <- s3_wilcox_post$Opinion_seaweed_post
s3_wilcox_post$video = "Post"
s3_wilcox_post <- s3_wilcox_post %>%
  dplyr::select(-Opinion_seaweed_post)

#bind dataframes
s3_wilcox_data <- rbind(s3_wilcox_pre, s3_wilcox_post)

```

```{r, Wilcoxon signed rank tests on opinion pre- and post video (not binned), include = FALSE}
####Wilcoxon Paired Rank Test - on on each group's pre-post
table(s2_wilcox_data$Opinion)
str(s2_wilcox_data)
s2_wilcox_data$Opinion = as.numeric(s2_wilcox_data$Opinion)
s2_wilcox_data$video = as.factor(s2_wilcox_data$video)

video_1 <- s2_wilcox_data %>%
  dplyr::filter(video_factor == "Mussels No Food")

video_2 <-s2_wilcox_data %>%
  dplyr::filter(video_factor == "Mussels Food Only")
  
video_3 <-s2_wilcox_data %>%
  dplyr::filter(video_factor == "Standard Intro")

video_4 <-s2_wilcox_data %>%
  dplyr::filter(video_factor == "Standard Closing")

video_5 <-s2_wilcox_data %>%
  dplyr::filter(video_factor == "Kanpachi No Food")

video_6 <-s2_wilcox_data %>%
  dplyr::filter(video_factor == "Kanpachi Food Only")

str(video_1)

test_1 <- video_1 %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_1 <- video_1 %>%
wilcox_effsize(Opinion ~ video, paired = TRUE)

test_2 <- video_2 %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_2 <- video_2 %>%
  wilcox_effsize(Opinion ~ video, paired = TRUE)

test_3 <- video_3 %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_3 <- video_3%>%
  wilcox_effsize(Opinion ~ video, paired = TRUE)

test_4 <- video_4 %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_4 <- video_4 %>%
  wilcox_effsize(Opinion ~ video, paired = TRUE)

test_5 <- video_5 %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_5 <- video_5 %>%
  wilcox_effsize(Opinion ~ video, paired = TRUE)

test_6 <- video_6 %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_6 <- video_6 %>%
  wilcox_effsize(Opinion ~ video, paired = TRUE)

#calculate averages for each
opinion_sum <- s2_wilcox_data %>%
  group_by(video_factor, video) %>%
  summarise(avg = sum(Opinion/length(Opinion)))

#test for seaweed farming (survey 3)

s3_wilcox_data$Opinion = as.numeric(s3_wilcox_data$Opinion)
test_sw <- s3_wilcox_data %>%
  wilcox_test(Opinion ~ video, paired = TRUE)
eff_sw <- s3_wilcox_data %>%
wilcox_effsize(Opinion ~ video, paired = TRUE)
sum_sw <- s3_wilcox_data %>%
  group_by(video) %>%
  summarise(avg = sum(Opinion/length(Opinion)))
```

```{r, Data for OLS message testing analyses, include = FALSE}
s2_m3 <- survey_2 %>%
  dplyr::select(c("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Opinion_aqua_pre"))

#Remove NAs - final n = 787
s2_m3 <- mutate_all(s2_m3, na_if, '#NULL!') 
s2_m3 <- s2_m3[complete.cases(s2_m3),]
table(s2_m3$Opinion_aqua_pre)
#group opinion into unfavorable, neutral, favorable
s2_m3$Opinion_aqua_pre <- case_when(
  s2_m3$Opinion_aqua_pre %% 4 == 0 ~ "Not sure",
  s2_m3$Opinion_aqua_pre %% 3 == 0 ~ "Favorable opinion of marine aquaculture",
  s2_m3$Opinion_aqua_pre %% 2 == 0 ~ "Neutral",
  s2_m3$Opinion_aqua_pre %% 1 == 0 ~ "Unfavorable opinion of marine aquaculture")

#long-form
s2_m3_long <- s2_m3 %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

s2_m3_long$rank = as.numeric(s2_m3_long$rank)

#make Message rank order into 5 ordinal categories:
s2_m3_long$rank <- case_when(
  s2_m3_long$rank %% 10 == 0 ~ 5,
  s2_m3_long$rank %% 9 == 0 ~ 5,
  s2_m3_long$rank %% 8 == 0 ~ 4,
  s2_m3_long$rank %% 7 == 0 ~ 4,
  s2_m3_long$rank %% 6 == 0 ~ 3,
  s2_m3_long$rank %% 5 == 0 ~ 3,
  s2_m3_long$rank %% 4 == 0 ~ 2,
  s2_m3_long$rank %% 3 == 0 ~ 2,
  s2_m3_long$rank %% 2 == 0 ~ 1,
  s2_m3_long$rank %% 1 == 0 ~ 1)

table(s2_m3_long$Message, s2_m3_long$rank)
#message, region, race are factors
s2_m3_long$Message = as.factor(s2_m3_long$Message)

#re-tell it that rank is an ordinal factor
s2_m3_long$rank = factor(s2_m3_long$rank,
                             ordered = TRUE,
                             levels = c("1", "2", "3", "4", "5"))

Message_1 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_1")
Message_2 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_2")
Message_3 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_3")
Message_4 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_4")
Message_5 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_5")
Message_6 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_6")
Message_7 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_7")
Message_8 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_8")
Message_9 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_9")
Message_10 <- s2_m3_long %>%
  dplyr::filter(Message == "Message_10")

####Survey 3 without resistant group####
#NOTE: code for this analysis with the resistant group is in the AoP Analyses.Rmd file still
s3_m3 <- survey_3 %>%
  dplyr::select("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Familiarity_seaweed", "Opinion_seaweed")

table(s3_m3$Opinion_seaweed)

#rename pre opinion to be group
colnames(s3_m3)[which(names(s3_m3) == "Opinion_seaweed")] <- "group"
table(s3_m3$group)
s3_m3$group <- case_when(
  s3_m3$group %% 7 == 0 ~ "Never heard",
  s3_m3$group %% 4 == 0 ~ "Not sure",
  s3_m3$group %% 3 == 0 ~ "Favorable opinion",
  s3_m3$group %% 2 == 0 ~ "Neutral",
  s3_m3$group %% 1 == 0 ~ "Unfavorable opinion")

table(s3_m3$Message_1)
s3_m3_long <- s3_m3 %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

s3_m3_long$rank = as.numeric(s3_m3_long$rank)
#make Message rank order 1-5 (1 very weak 5 very strong)
s3_m3_long$rank <- case_when(
  s3_m3_long$rank %% 10 == 0 ~ 5,
  s3_m3_long$rank %% 9 == 0 ~ 5,
  s3_m3_long$rank %% 8 == 0 ~ 4,
  s3_m3_long$rank %% 7 == 0 ~ 4,
  s3_m3_long$rank %% 6 == 0 ~ 3,
  s3_m3_long$rank %% 5 == 0 ~ 3,
  s3_m3_long$rank %% 4 == 0 ~ 2,
  s3_m3_long$rank %% 3 == 0 ~ 2,
  s3_m3_long$rank %% 2 == 0 ~ 1,
  s3_m3_long$rank %% 1 == 0 ~ 1)

table(s3_m3_long$Message, s3_m3_long$rank)


#message, region, race are factors
s3_m3_long$Message = as.factor(s3_m3_long$Message)

#Rank is an ordered factor
s3_m3_long$rank = factor(s3_m3_long$rank,
                             ordered = TRUE,
                             levels = c("1", "2", "3", "4", "5"))

Message_1_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_1")
Message_2_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_2")
Message_3_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_3")
Message_4_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_4")
Message_5_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_5")
Message_6_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_6")
Message_7_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_7")
Message_8_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_8")
Message_9_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_9")
Message_10_sw <- s3_m3_long %>%
  dplyr::filter(Message == "Message_10")

```

```{r, Ordered logistic regressions on rank order of messages, include = FALSE}
#Run models for survey 2 (marine aquaculture)
ols1_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_1, Hess = TRUE)
brant <- as.data.frame(brant(ols1_aq)) #meets parallel regression assumption

ols2_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_2, Hess = TRUE)
brant(ols2_aq) #meets parallel regression assumption

ols3_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_3, Hess = TRUE)
brant(ols3_aq) #meets parallel regression assumption

ols4_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_4, Hess = TRUE)
brant <- as.data.frame(brant(ols4_aq))#meets parallel regression assumption

ols5_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_5, Hess = TRUE)
brant <- as.data.frame(brant(ols5_aq))#meets parallel regression assumption

ols6_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_6, Hess = TRUE)
brant <- as.data.frame(brant(ols6_aq))#meets parallel regression assumption

ols7_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_7, Hess = TRUE)
brant <- as.data.frame(brant(ols7_aq))#meets parallel regression assumption

ols8_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_8, Hess = TRUE)
brant <- as.data.frame(brant(ols8_aq))#meets parallel regression assumption

ols9_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_9, Hess = TRUE)
brant <- as.data.frame(brant(ols9_aq))#meets parallel regression assumption

ols10_aq<-MASS::polr(rank~Opinion_aqua_pre, data = Message_10, Hess = TRUE)
brant <- as.data.frame(brant(ols10_aq))#meets parallel regression assumption

#query the models
Anova(ols1_aq)
Anova(ols2_aq)
Anova(ols3_aq)
Anova(ols4_aq)
Anova(ols5_aq)
Anova(ols6_aq)
Anova(ols7_aq)
Anova(ols8_aq)
Anova(ols9_aq)
Anova(ols10_aq)

#get coefficients
coefs_aq_1 <- coef(ols1_aq)
coefs_aq_2 <- coef(ols2_aq)
coefs_aq_3 <- coef(ols3_aq)
coefs_aq_4 <- coef(ols4_aq)
coefs_aq_5 <- coef(ols5_aq)
coefs_aq_6 <- coef(ols6_aq)
coefs_aq_7 <- coef(ols7_aq)
coefs_aq_8 <- coef(ols7_aq)
coefs_aq_9 <- coef(ols9_aq)
coefs_aq_10 <- coef(ols10_aq)
#Odds ratios - exponentiate the estimates and confidence intervals of the coefficients.
ci_aq_1 <- confint(ols1_aq)
exp(cbind(OR = coef(ols1_aq), ci_aq_1))
ci_aq_2 <- confint(ols2_aq)
exp(cbind(OR = coef(ols2_aq), ci_aq_2))
ci_aq_3 <- confint(ols3_aq)
exp(cbind(OR = coef(ols3_aq), ci_aq_3))
ci_aq_4 <- confint(ols4_aq)
exp(cbind(OR = coef(ols4_aq), ci_aq_4))
ci_aq_5 <- confint(ols5_aq)
exp(cbind(OR = coef(ols5_aq), ci_aq_5))
ci_aq_6 <- confint(ols6_aq)
exp(cbind(OR = coef(ols6_aq), ci_aq_6))
ci_aq_7 <- confint(ols7_aq)
exp(cbind(OR = coef(ols7_aq), ci_aq_7))
ci_aq_8 <- confint(ols8_aq)
exp(cbind(OR = coef(ols8_aq), ci_aq_8))
ci_aq_9 <- confint(ols9_aq)
exp(cbind(OR = coef(ols9_aq), ci_aq_9))
ci_aq_10 <- confint(ols10_aq)
exp(cbind(OR = coef(ols10_aq), ci_aq_10))


#run models for survey 3 (seaweed farming)
ols1_sw<-MASS::polr(rank~group, data = Message_1_sw, Hess = TRUE)
Anova(ols1_sw)
brant(ols1_sw) #meets parallel regression assumption

ols2_sw<-MASS::polr(rank~group, data = Message_2_sw, Hess = TRUE)
Anova(ols2_sw)
brant(ols2_sw) #meets parallel regression assumption

ols3_sw<-MASS::polr(rank~group, data = Message_3_sw, Hess = TRUE)
Anova(ols3_sw)
brant(ols3_sw) #meets parallel regression assumption

ols4_sw<-MASS::polr(rank~group, data = Message_4_sw, Hess = TRUE)
Anova(ols4_sw)
brant(ols4_sw)#meets parallel regression assumption

ols5_sw<-MASS::polr(rank~group, data = Message_5_sw, Hess = TRUE)
Anova(ols5_sw)
brant(ols5_sw)#meets parallel regression assumption

ols6_sw<-MASS::polr(rank~group, data = Message_6_sw, Hess = TRUE)
Anova(ols6_sw)
brant(ols6_sw)#meets parallel regression assumption

ols7_sw<-MASS::polr(rank~group, data = Message_7_sw, Hess = TRUE)
Anova(ols7_sw)
brant(ols7_sw)#meets parallel regression assumption

ols8_sw<-MASS::polr(rank~group, data = Message_8_sw, Hess = TRUE)
Anova(ols8_sw)
brant(ols8_sw)#meets parallel regression assumption

ols9_sw<-MASS::polr(rank~group, data = Message_9_sw, Hess = TRUE)
Anova(ols9_sw)
brant(ols9_sw)#meets parallel regression assumption

ols10_sw<-MASS::polr(rank~group, data = Message_10_sw, Hess = TRUE)
Anova(ols10_sw)
brant(ols10_sw)#meets parallel regression assumption

#get coefficients
coefs_sw_1 <- coef(ols1_sw)
coefs_sw_2 <- coef(ols2_sw)
coefs_sw_3 <- coef(ols3_sw)
coefs_sw_4 <- coef(ols4_sw)
coefs_sw_5 <- coef(ols5_sw)
coefs_sw_6 <- coef(ols6_sw)
coefs_sw_7 <- coef(ols7_sw)
coefs_sw_8 <- coef(ols8_sw)
coefs_sw_9 <- coef(ols9_sw)
coefs_sw_10 <- coef(ols10_sw)
#Odds ratios - exponentiate the estimates and confidence intervals of the coefficients.
ci_sw_1 <- confint(ols1_sw)
exp(cbind(OR = coef(ols1_sw), ci_sw_1))
ci_sw_2 <- confint(ols2_sw)
exp(cbind(OR = coef(ols2_sw), ci_sw_2))
ci_sw_3 <- confint(ols3_sw)
exp(cbind(OR = coef(ols3_sw), ci_sw_3))
ci_sw_4 <- confint(ols4_sw)
exp(cbind(OR = coef(ols4_sw), ci_sw_4))
ci_sw_5 <- confint(ols5_sw)
exp(cbind(OR = coef(ols5_sw), ci_sw_5))
ci_sw_6 <- confint(ols6_sw)
exp(cbind(OR = coef(ols6_sw), ci_sw_6))
ci_sw_7 <- confint(ols7_sw)
exp(cbind(OR = coef(ols7_sw), ci_sw_7))
ci_sw_8 <- confint(ols8_sw)
exp(cbind(OR = coef(ols8_sw), ci_sw_8))
ci_sw_9 <- confint(ols9_sw)
exp(cbind(OR = coef(ols9_sw), ci_sw_9))
ci_sw_10 <- confint(ols10_sw)
exp(cbind(OR = coef(ols10_sw), ci_sw_10))

survey_3_long <- survey_3 %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')
survey_3_long$rank <- case_when(
  survey_3_long$rank %% 10 == 0 ~ 5,
  survey_3_long$rank %% 9 == 0 ~ 5,
  survey_3_long$rank %% 8 == 0 ~ 4,
  survey_3_long$rank %% 7 == 0 ~ 4,
  survey_3_long$rank %% 6 == 0 ~ 3,
  survey_3_long$rank %% 5 == 0 ~ 3,
  survey_3_long$rank %% 4 == 0 ~ 2,
  survey_3_long$rank %% 3 == 0 ~ 2,
  survey_3_long$rank %% 2 == 0 ~ 1,
  survey_3_long$rank %% 1 == 0 ~ 1)

```

```{r, Data for binomial logistic regression on message testing, include = FALSE}
###note to self that what i'm doing here repeats the code in the message heat map chunk and eventually can be consolodated.

#Data for coastal states only#
s2_binom <- survey_2 %>%
  dplyr::select(c("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Opinion_aqua_pre"))

#Remove NAs - final n = 153
s2_binom <- mutate_all(s2_binom, na_if, '#NULL!') 
s2_binom <- s2_binom[complete.cases(s2_binom),]
table(s2_binom$Opinion_aqua_pre)

#Mutate to long-form data
s2_binom <- s2_binom %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

#Set up rankings to be in three categories: 0 = weak, 1 = strong, 3 = neutral:
s2_binom$rank_factor <- case_when(
     s2_binom$rank %% 10 == 0 ~ 1,
     s2_binom$rank %% 9 == 0 ~ 1,
     s2_binom$rank %% 8 == 0 ~ 1,
     s2_binom$rank %% 7 == 0 ~ 1,
     s2_binom$rank %% 6 == 0 ~ 3,
     s2_binom$rank %% 5 == 0 ~ 3,
     s2_binom$rank %% 4 == 0 ~ 0,
     s2_binom$rank %% 3 == 0 ~ 0,
     s2_binom$rank %% 2 == 0 ~ 0,
     s2_binom$rank %% 1 == 0 ~ 0)

#Supplemental table S4 in paper
table(s2_binom$rank_factor, s2_binom$Message)

#Survey 3 data for heat map plot without resistant group
s3_binom <- survey_3 %>%
  dplyr::select(c("Message_1", "Message_2", "Message_3", "Message_4", "Message_5", "Message_6", "Message_7", "Message_8", "Message_9", "Message_10", "Opinion_seaweed"))
table(s3_binom$Opinion_seaweed)

#Remove NAs - final total n = 865
s3_binom <- mutate_all(s3_binom, na_if, '#NULL!')
s3_binom <- s3_binom[complete.cases(s3_binom),]

#group opinion into unfavorable, neutral, favorable, never heard
s3_binom$Opinion_seaweed <- case_when(
  s3_binom$Opinion_seaweed %% 7 == 0 ~ "Never heard",
  s3_binom$Opinion_seaweed %% 4 == 0 ~ "Not sure",
  s3_binom$Opinion_seaweed %% 3 == 0 ~ "Favorable",
  s3_binom$Opinion_seaweed %% 2 == 0 ~ "Neutral",
  s3_binom$Opinion_seaweed %% 1 == 0 ~ "Unfavorable"
)

table(s3_binom$Opinion_seaweed)

#Mutate to long-form data
s3_binom <- s3_binom %>%
  pivot_longer(cols = Message_1:Message_10, names_to = "Message",
               values_to = 'rank')

#Set up rankings to be in three categories: 0 = weak, 1 = strong, 3 = neutral:
s3_binom$rank_factor <- case_when(
     s3_binom$rank %% 10 == 0 ~ 1,
     s3_binom$rank %% 9 == 0 ~ 1,
     s3_binom$rank %% 8 == 0 ~ 1,
     s3_binom$rank %% 7 == 0 ~ 1,
     s3_binom$rank %% 6 == 0 ~ 3,
     s3_binom$rank %% 5 == 0 ~ 3,
     s3_binom$rank %% 4 == 0 ~ 0,
     s3_binom$rank %% 3 == 0 ~ 0,
     s3_binom$rank %% 2 == 0 ~ 0,
     s3_binom$rank %% 1 == 0 ~ 0)

#remove the neutral reason group for the binomial
s2_binom$rank_factor = as.numeric(s2_binom$rank_factor)
s2_binom <- s2_binom %>%
  dplyr::filter(rank_factor != 3)

s3_binom$rank_factor = as.numeric(s3_binom$rank_factor)
s3_binom <- s3_binom %>%
  dplyr::filter(rank_factor != 3)

```

```{r, Binomial logistic regression on message testing, include = FALSE}

#Run the binomial glm for survey2 
glm2 <- glm(rank_factor ~ Message * Opinion_aqua_pre, data = s2_binom,
            family = "binomial")
summary(glm2)
#Test the assumptions

#Test fitted vs. residuals plot to cover dispersion, outliers, uniformity

#simulate the residuals and inspect plots
output2 <- simulateResiduals(fittedModel = glm2)

#Uniformity, dispersion, and outliers
plotQQunif(output2) #Dispersion: p = 0.94, Outlier: p = 0.75, KS test: p = 0.94, deviations not significant.
plotResiduals(output2)

#query the model
Anova(glm2)

#Interpret as odds-ratios with 95% CI
#odds ratios and 95% CI:
exp(cbind(OR = coef(glm2), confint(glm2)))
#pull pairs/contrasts for contrast table
em2 <- emmeans(glm2, ~Message, type = "response")
pairs2 <-pairs(em2, adjust = "tukey")
#Wald test for an overall effect 
wald.test(b = coef(glm2), Sigma = vcov(glm2), Terms = 2:3)
#X2 = 6.6, df = 2, P(> X2) = 0.037 #overall model holds.

#Run the binomial glm for survey3
glm3 <- glm(rank_factor ~ Message*Opinion_seaweed, data = s3_binom,
            family = "binomial")
summary(glm3)
#Test the assumptions
output3 <- simulateResiduals(fittedModel = glm3)
#Uniformity, dispersion, and outliers
plotQQunif(output3) #Dispersion: p = 0.87, Outlier: p = 0.59, KS test: p = 0.87, deviations not significant.
plotResiduals(output3)
#query the model
Anova(glm3)

#Interpret as odds-ratios with 95% CI
#odds ratios and 95% CI:
exp(cbind(OR = coef(glm3), confint(glm3)))
#pull pairs/contrasts for contrast table
em3 <- emmeans(glm3, ~Message, type = "response")
pairs3 <-pairs(em3, adjust = "tukey")
#Wald test for an overall effect 
wald.test(b = coef(glm3), Sigma = vcov(glm3), Terms = 2:3)
#X2 = 334.0, df = 2, P(> X2) = 0.0 #overall model holds.

```
